567ec5c0a4e372f1d8d1e2ca1c3f513a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@angular/core/testing");
const core_1 = require("@ngx-translate/core");
const translation_config_1 = require("../../config/translation.config");
const alert_service_1 = require("./alert.service");
describe('Alert service test', () => {
    describe('Alert Service Test', () => {
        let extAlerts;
        beforeEach(() => {
            testing_1.TestBed.configureTestingModule({
                imports: [
                    core_1.TranslateModule.forRoot({
                        missingTranslationHandler: {
                            provide: core_1.MissingTranslationHandler,
                            useFactory: translation_config_1.missingTranslationHandler,
                        },
                    }),
                ],
            });
            const translateService = testing_1.TestBed.inject(core_1.TranslateService);
            translateService.setDefaultLang('en');
            jest.useFakeTimers();
            extAlerts = [];
        });
        it('should produce a proper alert object and fetch it', testing_1.inject([alert_service_1.AlertService], (service) => {
            expect(service.addAlert({
                type: 'success',
                message: 'Hello Jhipster',
                timeout: 3000,
                toast: true,
                position: 'top left',
            })).toEqual(expect.objectContaining({
                type: 'success',
                message: 'Hello Jhipster',
                id: 0,
                timeout: 3000,
                toast: true,
                position: 'top left',
            }));
            expect(service.get().length).toBe(1);
            expect(service.get()[0]).toEqual(expect.objectContaining({
                type: 'success',
                message: 'Hello Jhipster',
                id: 0,
                timeout: 3000,
                toast: true,
                position: 'top left',
            }));
        }));
        it('should produce a proper alert object and add it to external alert objects array', testing_1.inject([alert_service_1.AlertService], (service) => {
            expect(service.addAlert({
                type: 'success',
                message: 'Hello Jhipster',
                timeout: 3000,
                toast: true,
                position: 'top left',
            }, extAlerts)).toEqual(expect.objectContaining({
                type: 'success',
                message: 'Hello Jhipster',
                id: 0,
                timeout: 3000,
                toast: true,
                position: 'top left',
            }));
            expect(extAlerts.length).toBe(1);
            expect(extAlerts[0]).toEqual(expect.objectContaining({
                type: 'success',
                message: 'Hello Jhipster',
                id: 0,
                timeout: 3000,
                toast: true,
                position: 'top left',
            }));
        }));
        it('should produce an alert object with correct id', testing_1.inject([alert_service_1.AlertService], (service) => {
            service.addAlert({ type: 'info', message: 'Hello Jhipster info' });
            expect(service.addAlert({ type: 'success', message: 'Hello Jhipster success' })).toEqual(expect.objectContaining({
                type: 'success',
                message: 'Hello Jhipster success',
                id: 1,
            }));
            expect(service.get().length).toBe(2);
            expect(service.get()[1]).toEqual(expect.objectContaining({
                type: 'success',
                message: 'Hello Jhipster success',
                id: 1,
            }));
        }));
        it('should close an alert correctly', testing_1.inject([alert_service_1.AlertService], (service) => {
            var _a, _b, _c;
            const alert0 = service.addAlert({ type: 'info', message: 'Hello Jhipster info' });
            const alert1 = service.addAlert({ type: 'info', message: 'Hello Jhipster info 2' });
            const alert2 = service.addAlert({ type: 'success', message: 'Hello Jhipster success' });
            expect(alert2).toEqual(expect.objectContaining({
                type: 'success',
                message: 'Hello Jhipster success',
                id: 2,
            }));
            expect(service.get().length).toBe(3);
            (_a = alert1.close) === null || _a === void 0 ? void 0 : _a.call(alert1, service.get());
            expect(service.get().length).toBe(2);
            expect(service.get()[1]).not.toEqual(expect.objectContaining({
                type: 'info',
                message: 'Hello Jhipster info 2',
                id: 1,
            }));
            (_b = alert2.close) === null || _b === void 0 ? void 0 : _b.call(alert2, service.get());
            expect(service.get().length).toBe(1);
            expect(service.get()[0]).not.toEqual(expect.objectContaining({
                type: 'success',
                message: 'Hello Jhipster success',
                id: 2,
            }));
            (_c = alert0.close) === null || _c === void 0 ? void 0 : _c.call(alert0, service.get());
            expect(service.get().length).toBe(0);
        }));
        it('should close an alert on timeout correctly', testing_1.inject([alert_service_1.AlertService], (service) => {
            service.addAlert({ type: 'info', message: 'Hello Jhipster info' });
            expect(service.get().length).toBe(1);
            jest.advanceTimersByTime(6000);
            expect(service.get().length).toBe(0);
        }));
        it('should clear alerts', testing_1.inject([alert_service_1.AlertService], (service) => {
            service.addAlert({ type: 'info', message: 'Hello Jhipster info' });
            service.addAlert({ type: 'danger', message: 'Hello Jhipster info' });
            service.addAlert({ type: 'success', message: 'Hello Jhipster info' });
            expect(service.get().length).toBe(3);
            service.clear();
            expect(service.get().length).toBe(0);
        }));
        it('should produce a scoped alert', testing_1.inject([alert_service_1.AlertService], (service) => {
            expect(service.addAlert({
                type: 'success',
                message: 'Hello Jhipster',
                timeout: 3000,
                toast: true,
                position: 'top left',
            }, [])).toEqual(expect.objectContaining({
                type: 'success',
                message: 'Hello Jhipster',
                id: 0,
                timeout: 3000,
                toast: true,
                position: 'top left',
            }));
            expect(service.get().length).toBe(0);
        }));
        it('should produce a success message', testing_1.inject([alert_service_1.AlertService], (service) => {
            expect(service.addAlert({ type: 'success', message: 'Hello Jhipster' })).toEqual(expect.objectContaining({
                type: 'success',
                message: 'Hello Jhipster',
            }));
        }));
        it('should produce a success message with custom position', testing_1.inject([alert_service_1.AlertService], (service) => {
            expect(service.addAlert({ type: 'success', message: 'Hello Jhipster', position: 'bottom left' })).toEqual(expect.objectContaining({
                type: 'success',
                message: 'Hello Jhipster',
                position: 'bottom left',
            }));
        }));
        it('should produce a error message', testing_1.inject([alert_service_1.AlertService], (service) => {
            expect(service.addAlert({ type: 'danger', message: 'Hello Jhipster' })).toEqual(expect.objectContaining({
                type: 'danger',
                message: 'Hello Jhipster',
            }));
        }));
        it('should produce a warning message', testing_1.inject([alert_service_1.AlertService], (service) => {
            expect(service.addAlert({ type: 'warning', message: 'Hello Jhipster' })).toEqual(expect.objectContaining({
                type: 'warning',
                message: 'Hello Jhipster',
            }));
        }));
        it('should produce a info message', testing_1.inject([alert_service_1.AlertService], (service) => {
            expect(service.addAlert({ type: 'info', message: 'Hello Jhipster' })).toEqual(expect.objectContaining({
                type: 'info',
                message: 'Hello Jhipster',
            }));
        }));
        it('should produce a info message with translated message if key exists', testing_1.inject([alert_service_1.AlertService, core_1.TranslateService], (service, translateService) => {
            translateService.setTranslation('en', {
                'hello.jhipster': 'Translated message',
            });
            expect(service.addAlert({ type: 'info', message: 'Hello Jhipster', translationKey: 'hello.jhipster' })).toEqual(expect.objectContaining({
                type: 'info',
                message: 'Translated message',
            }));
        }));
        it('should produce a info message with provided message if key does not exists', testing_1.inject([alert_service_1.AlertService, core_1.TranslateService], (service) => {
            expect(service.addAlert({ type: 'info', message: 'Hello Jhipster', translationKey: 'hello.jhipster' })).toEqual(expect.objectContaining({
                type: 'info',
                message: 'Hello Jhipster',
            }));
        }));
        it('should produce a info message with provided key if transltion key does not exist in translations and message is not provided', testing_1.inject([alert_service_1.AlertService, core_1.TranslateService], (service) => {
            expect(service.addAlert({ type: 'info', translationKey: 'hello.jhipster' })).toEqual(expect.objectContaining({
                type: 'info',
                message: 'hello.jhipster',
            }));
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxOaWNvbGFzXFxEZXNrdG9wXFx0ZXN0NlxcZ2F0ZXdheVxcc3JjXFxtYWluXFx3ZWJhcHBcXGFwcFxcY29yZVxcdXRpbFxcYWxlcnQuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsbURBQXdEO0FBQ3hELDhDQUFtRztBQUNuRyx3RUFBNEU7QUFFNUUsbURBQXNEO0FBRXRELFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7SUFDbEMsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtRQUNsQyxJQUFJLFNBQWtCLENBQUM7UUFFdkIsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLGlCQUFPLENBQUMsc0JBQXNCLENBQUM7Z0JBQzdCLE9BQU8sRUFBRTtvQkFDUCxzQkFBZSxDQUFDLE9BQU8sQ0FBQzt3QkFDdEIseUJBQXlCLEVBQUU7NEJBQ3pCLE9BQU8sRUFBRSxnQ0FBeUI7NEJBQ2xDLFVBQVUsRUFBRSw4Q0FBeUI7eUJBQ3RDO3FCQUNGLENBQUM7aUJBQ0g7YUFDRixDQUFDLENBQUM7WUFDSCxNQUFNLGdCQUFnQixHQUFHLGlCQUFPLENBQUMsTUFBTSxDQUFDLHVCQUFnQixDQUFDLENBQUM7WUFDMUQsZ0JBQWdCLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNyQixTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG1EQUFtRCxFQUFFLGdCQUFNLENBQUMsQ0FBQyw0QkFBWSxDQUFDLEVBQUUsQ0FBQyxPQUFxQixFQUFFLEVBQUU7WUFDdkcsTUFBTSxDQUNKLE9BQU8sQ0FBQyxRQUFRLENBQUM7Z0JBQ2YsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsT0FBTyxFQUFFLGdCQUFnQjtnQkFDekIsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsS0FBSyxFQUFFLElBQUk7Z0JBQ1gsUUFBUSxFQUFFLFVBQVU7YUFDckIsQ0FBQyxDQUNILENBQUMsT0FBTyxDQUNQLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsT0FBTyxFQUFFLGdCQUFnQjtnQkFDekIsRUFBRSxFQUFFLENBQUM7Z0JBQ0wsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsS0FBSyxFQUFFLElBQUk7Z0JBQ1gsUUFBUSxFQUFFLFVBQVU7YUFDWixDQUFDLENBQ1osQ0FBQztZQUVGLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQzlCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsT0FBTyxFQUFFLGdCQUFnQjtnQkFDekIsRUFBRSxFQUFFLENBQUM7Z0JBQ0wsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsS0FBSyxFQUFFLElBQUk7Z0JBQ1gsUUFBUSxFQUFFLFVBQVU7YUFDWixDQUFDLENBQ1osQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFSixFQUFFLENBQUMsaUZBQWlGLEVBQUUsZ0JBQU0sQ0FDMUYsQ0FBQyw0QkFBWSxDQUFDLEVBQ2QsQ0FBQyxPQUFxQixFQUFFLEVBQUU7WUFDeEIsTUFBTSxDQUNKLE9BQU8sQ0FBQyxRQUFRLENBQ2Q7Z0JBQ0UsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsT0FBTyxFQUFFLGdCQUFnQjtnQkFDekIsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsS0FBSyxFQUFFLElBQUk7Z0JBQ1gsUUFBUSxFQUFFLFVBQVU7YUFDckIsRUFDRCxTQUFTLENBQ1YsQ0FDRixDQUFDLE9BQU8sQ0FDUCxNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ3RCLElBQUksRUFBRSxTQUFTO2dCQUNmLE9BQU8sRUFBRSxnQkFBZ0I7Z0JBQ3pCLEVBQUUsRUFBRSxDQUFDO2dCQUNMLE9BQU8sRUFBRSxJQUFJO2dCQUNiLEtBQUssRUFBRSxJQUFJO2dCQUNYLFFBQVEsRUFBRSxVQUFVO2FBQ1osQ0FBQyxDQUNaLENBQUM7WUFFRixNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUMxQixNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ3RCLElBQUksRUFBRSxTQUFTO2dCQUNmLE9BQU8sRUFBRSxnQkFBZ0I7Z0JBQ3pCLEVBQUUsRUFBRSxDQUFDO2dCQUNMLE9BQU8sRUFBRSxJQUFJO2dCQUNiLEtBQUssRUFBRSxJQUFJO2dCQUNYLFFBQVEsRUFBRSxVQUFVO2FBQ1osQ0FBQyxDQUNaLENBQUM7UUFDSixDQUFDLENBQ0YsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGdEQUFnRCxFQUFFLGdCQUFNLENBQUMsQ0FBQyw0QkFBWSxDQUFDLEVBQUUsQ0FBQyxPQUFxQixFQUFFLEVBQUU7WUFDcEcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLENBQUMsQ0FBQztZQUNuRSxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FDdEYsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUN0QixJQUFJLEVBQUUsU0FBUztnQkFDZixPQUFPLEVBQUUsd0JBQXdCO2dCQUNqQyxFQUFFLEVBQUUsQ0FBQzthQUNHLENBQUMsQ0FDWixDQUFDO1lBRUYsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FDOUIsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUN0QixJQUFJLEVBQUUsU0FBUztnQkFDZixPQUFPLEVBQUUsd0JBQXdCO2dCQUNqQyxFQUFFLEVBQUUsQ0FBQzthQUNHLENBQUMsQ0FDWixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVKLEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxnQkFBTSxDQUFDLENBQUMsNEJBQVksQ0FBQyxFQUFFLENBQUMsT0FBcUIsRUFBRSxFQUFFOztZQUNyRixNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsQ0FBQyxDQUFDO1lBQ2xGLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxDQUFDLENBQUM7WUFDcEYsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLENBQUMsQ0FBQztZQUN4RixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUNwQixNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ3RCLElBQUksRUFBRSxTQUFTO2dCQUNmLE9BQU8sRUFBRSx3QkFBd0I7Z0JBQ2pDLEVBQUUsRUFBRSxDQUFDO2FBQ0csQ0FBQyxDQUNaLENBQUM7WUFFRixNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyQyxNQUFBLE1BQU0sQ0FBQyxLQUFLLCtDQUFaLE1BQU0sRUFBUyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUM5QixNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FDbEMsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUN0QixJQUFJLEVBQUUsTUFBTTtnQkFDWixPQUFPLEVBQUUsdUJBQXVCO2dCQUNoQyxFQUFFLEVBQUUsQ0FBQzthQUNHLENBQUMsQ0FDWixDQUFDO1lBQ0YsTUFBQSxNQUFNLENBQUMsS0FBSywrQ0FBWixNQUFNLEVBQVMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDOUIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQ2xDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsT0FBTyxFQUFFLHdCQUF3QjtnQkFDakMsRUFBRSxFQUFFLENBQUM7YUFDRyxDQUFDLENBQ1osQ0FBQztZQUNGLE1BQUEsTUFBTSxDQUFDLEtBQUssK0NBQVosTUFBTSxFQUFTLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFSixFQUFFLENBQUMsNENBQTRDLEVBQUUsZ0JBQU0sQ0FBQyxDQUFDLDRCQUFZLENBQUMsRUFBRSxDQUFDLE9BQXFCLEVBQUUsRUFBRTtZQUNoRyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsQ0FBQyxDQUFDO1lBRW5FLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXJDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUUvQixNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRUosRUFBRSxDQUFDLHFCQUFxQixFQUFFLGdCQUFNLENBQUMsQ0FBQyw0QkFBWSxDQUFDLEVBQUUsQ0FBQyxPQUFxQixFQUFFLEVBQUU7WUFDekUsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLENBQUMsQ0FBQztZQUNuRSxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsQ0FBQyxDQUFDO1lBQ3JFLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxDQUFDLENBQUM7WUFDdEUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2hCLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFSixFQUFFLENBQUMsK0JBQStCLEVBQUUsZ0JBQU0sQ0FBQyxDQUFDLDRCQUFZLENBQUMsRUFBRSxDQUFDLE9BQXFCLEVBQUUsRUFBRTtZQUNuRixNQUFNLENBQ0osT0FBTyxDQUFDLFFBQVEsQ0FDZDtnQkFDRSxJQUFJLEVBQUUsU0FBUztnQkFDZixPQUFPLEVBQUUsZ0JBQWdCO2dCQUN6QixPQUFPLEVBQUUsSUFBSTtnQkFDYixLQUFLLEVBQUUsSUFBSTtnQkFDWCxRQUFRLEVBQUUsVUFBVTthQUNyQixFQUNELEVBQUUsQ0FDSCxDQUNGLENBQUMsT0FBTyxDQUNQLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsT0FBTyxFQUFFLGdCQUFnQjtnQkFDekIsRUFBRSxFQUFFLENBQUM7Z0JBQ0wsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsS0FBSyxFQUFFLElBQUk7Z0JBQ1gsUUFBUSxFQUFFLFVBQVU7YUFDWixDQUFDLENBQ1osQ0FBQztZQUVGLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFSixFQUFFLENBQUMsa0NBQWtDLEVBQUUsZ0JBQU0sQ0FBQyxDQUFDLDRCQUFZLENBQUMsRUFBRSxDQUFDLE9BQXFCLEVBQUUsRUFBRTtZQUN0RixNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FDOUUsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUN0QixJQUFJLEVBQUUsU0FBUztnQkFDZixPQUFPLEVBQUUsZ0JBQWdCO2FBQ2pCLENBQUMsQ0FDWixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVKLEVBQUUsQ0FBQyx1REFBdUQsRUFBRSxnQkFBTSxDQUFDLENBQUMsNEJBQVksQ0FBQyxFQUFFLENBQUMsT0FBcUIsRUFBRSxFQUFFO1lBQzNHLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsUUFBUSxFQUFFLGFBQWEsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQ3ZHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsT0FBTyxFQUFFLGdCQUFnQjtnQkFDekIsUUFBUSxFQUFFLGFBQWE7YUFDZixDQUFDLENBQ1osQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFSixFQUFFLENBQUMsZ0NBQWdDLEVBQUUsZ0JBQU0sQ0FBQyxDQUFDLDRCQUFZLENBQUMsRUFBRSxDQUFDLE9BQXFCLEVBQUUsRUFBRTtZQUNwRixNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FDN0UsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUN0QixJQUFJLEVBQUUsUUFBUTtnQkFDZCxPQUFPLEVBQUUsZ0JBQWdCO2FBQ2pCLENBQUMsQ0FDWixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVKLEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxnQkFBTSxDQUFDLENBQUMsNEJBQVksQ0FBQyxFQUFFLENBQUMsT0FBcUIsRUFBRSxFQUFFO1lBQ3RGLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUM5RSxNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ3RCLElBQUksRUFBRSxTQUFTO2dCQUNmLE9BQU8sRUFBRSxnQkFBZ0I7YUFDakIsQ0FBQyxDQUNaLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRUosRUFBRSxDQUFDLCtCQUErQixFQUFFLGdCQUFNLENBQUMsQ0FBQyw0QkFBWSxDQUFDLEVBQUUsQ0FBQyxPQUFxQixFQUFFLEVBQUU7WUFDbkYsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQzNFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsSUFBSSxFQUFFLE1BQU07Z0JBQ1osT0FBTyxFQUFFLGdCQUFnQjthQUNqQixDQUFDLENBQ1osQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFSixFQUFFLENBQUMscUVBQXFFLEVBQUUsZ0JBQU0sQ0FDOUUsQ0FBQyw0QkFBWSxFQUFFLHVCQUFnQixDQUFDLEVBQ2hDLENBQUMsT0FBcUIsRUFBRSxnQkFBa0MsRUFBRSxFQUFFO1lBQzVELGdCQUFnQixDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUU7Z0JBQ3BDLGdCQUFnQixFQUFFLG9CQUFvQjthQUN2QyxDQUFDLENBQUM7WUFDSCxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLGNBQWMsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQzdHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsSUFBSSxFQUFFLE1BQU07Z0JBQ1osT0FBTyxFQUFFLG9CQUFvQjthQUNyQixDQUFDLENBQ1osQ0FBQztRQUNKLENBQUMsQ0FDRixDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNEVBQTRFLEVBQUUsZ0JBQU0sQ0FDckYsQ0FBQyw0QkFBWSxFQUFFLHVCQUFnQixDQUFDLEVBQ2hDLENBQUMsT0FBcUIsRUFBRSxFQUFFO1lBQ3hCLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FDN0csTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUN0QixJQUFJLEVBQUUsTUFBTTtnQkFDWixPQUFPLEVBQUUsZ0JBQWdCO2FBQ2pCLENBQUMsQ0FDWixDQUFDO1FBQ0osQ0FBQyxDQUNGLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4SEFBOEgsRUFBRSxnQkFBTSxDQUN2SSxDQUFDLDRCQUFZLEVBQUUsdUJBQWdCLENBQUMsRUFDaEMsQ0FBQyxPQUFxQixFQUFFLEVBQUU7WUFDeEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQ2xGLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsSUFBSSxFQUFFLE1BQU07Z0JBQ1osT0FBTyxFQUFFLGdCQUFnQjthQUNqQixDQUFDLENBQ1osQ0FBQztRQUNKLENBQUMsQ0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcTmljb2xhc1xcRGVza3RvcFxcdGVzdDZcXGdhdGV3YXlcXHNyY1xcbWFpblxcd2ViYXBwXFxhcHBcXGNvcmVcXHV0aWxcXGFsZXJ0LnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3QsIFRlc3RCZWQgfSBmcm9tICdAYW5ndWxhci9jb3JlL3Rlc3RpbmcnO1xuaW1wb3J0IHsgVHJhbnNsYXRlTW9kdWxlLCBUcmFuc2xhdGVTZXJ2aWNlLCBNaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBtaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyIH0gZnJvbSAnLi4vLi4vY29uZmlnL3RyYW5zbGF0aW9uLmNvbmZpZyc7XG5cbmltcG9ydCB7IEFsZXJ0LCBBbGVydFNlcnZpY2UgfSBmcm9tICcuL2FsZXJ0LnNlcnZpY2UnO1xuXG5kZXNjcmliZSgnQWxlcnQgc2VydmljZSB0ZXN0JywgKCkgPT4ge1xuICBkZXNjcmliZSgnQWxlcnQgU2VydmljZSBUZXN0JywgKCkgPT4ge1xuICAgIGxldCBleHRBbGVydHM6IEFsZXJ0W107XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIFRlc3RCZWQuY29uZmlndXJlVGVzdGluZ01vZHVsZSh7XG4gICAgICAgIGltcG9ydHM6IFtcbiAgICAgICAgICBUcmFuc2xhdGVNb2R1bGUuZm9yUm9vdCh7XG4gICAgICAgICAgICBtaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyOiB7XG4gICAgICAgICAgICAgIHByb3ZpZGU6IE1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXIsXG4gICAgICAgICAgICAgIHVzZUZhY3Rvcnk6IG1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pLFxuICAgICAgICBdLFxuICAgICAgfSk7XG4gICAgICBjb25zdCB0cmFuc2xhdGVTZXJ2aWNlID0gVGVzdEJlZC5pbmplY3QoVHJhbnNsYXRlU2VydmljZSk7XG4gICAgICB0cmFuc2xhdGVTZXJ2aWNlLnNldERlZmF1bHRMYW5nKCdlbicpO1xuICAgICAgamVzdC51c2VGYWtlVGltZXJzKCk7XG4gICAgICBleHRBbGVydHMgPSBbXTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvZHVjZSBhIHByb3BlciBhbGVydCBvYmplY3QgYW5kIGZldGNoIGl0JywgaW5qZWN0KFtBbGVydFNlcnZpY2VdLCAoc2VydmljZTogQWxlcnRTZXJ2aWNlKSA9PiB7XG4gICAgICBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UuYWRkQWxlcnQoe1xuICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXInLFxuICAgICAgICAgIHRpbWVvdXQ6IDMwMDAsXG4gICAgICAgICAgdG9hc3Q6IHRydWUsXG4gICAgICAgICAgcG9zaXRpb246ICd0b3AgbGVmdCcsXG4gICAgICAgIH0pXG4gICAgICApLnRvRXF1YWwoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXG4gICAgICAgICAgbWVzc2FnZTogJ0hlbGxvIEpoaXBzdGVyJyxcbiAgICAgICAgICBpZDogMCxcbiAgICAgICAgICB0aW1lb3V0OiAzMDAwLFxuICAgICAgICAgIHRvYXN0OiB0cnVlLFxuICAgICAgICAgIHBvc2l0aW9uOiAndG9wIGxlZnQnLFxuICAgICAgICB9IGFzIEFsZXJ0KVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0KCkubGVuZ3RoKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0KClbMF0pLnRvRXF1YWwoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXG4gICAgICAgICAgbWVzc2FnZTogJ0hlbGxvIEpoaXBzdGVyJyxcbiAgICAgICAgICBpZDogMCxcbiAgICAgICAgICB0aW1lb3V0OiAzMDAwLFxuICAgICAgICAgIHRvYXN0OiB0cnVlLFxuICAgICAgICAgIHBvc2l0aW9uOiAndG9wIGxlZnQnLFxuICAgICAgICB9IGFzIEFsZXJ0KVxuICAgICAgKTtcbiAgICB9KSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb2R1Y2UgYSBwcm9wZXIgYWxlcnQgb2JqZWN0IGFuZCBhZGQgaXQgdG8gZXh0ZXJuYWwgYWxlcnQgb2JqZWN0cyBhcnJheScsIGluamVjdChcbiAgICAgIFtBbGVydFNlcnZpY2VdLFxuICAgICAgKHNlcnZpY2U6IEFsZXJ0U2VydmljZSkgPT4ge1xuICAgICAgICBleHBlY3QoXG4gICAgICAgICAgc2VydmljZS5hZGRBbGVydChcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgICBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXInLFxuICAgICAgICAgICAgICB0aW1lb3V0OiAzMDAwLFxuICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSxcbiAgICAgICAgICAgICAgcG9zaXRpb246ICd0b3AgbGVmdCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXh0QWxlcnRzXG4gICAgICAgICAgKVxuICAgICAgICApLnRvRXF1YWwoXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgbWVzc2FnZTogJ0hlbGxvIEpoaXBzdGVyJyxcbiAgICAgICAgICAgIGlkOiAwLFxuICAgICAgICAgICAgdGltZW91dDogMzAwMCxcbiAgICAgICAgICAgIHRvYXN0OiB0cnVlLFxuICAgICAgICAgICAgcG9zaXRpb246ICd0b3AgbGVmdCcsXG4gICAgICAgICAgfSBhcyBBbGVydClcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QoZXh0QWxlcnRzLmxlbmd0aCkudG9CZSgxKTtcbiAgICAgICAgZXhwZWN0KGV4dEFsZXJ0c1swXSkudG9FcXVhbChcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXG4gICAgICAgICAgICBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXInLFxuICAgICAgICAgICAgaWQ6IDAsXG4gICAgICAgICAgICB0aW1lb3V0OiAzMDAwLFxuICAgICAgICAgICAgdG9hc3Q6IHRydWUsXG4gICAgICAgICAgICBwb3NpdGlvbjogJ3RvcCBsZWZ0JyxcbiAgICAgICAgICB9IGFzIEFsZXJ0KVxuICAgICAgICApO1xuICAgICAgfVxuICAgICkpO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm9kdWNlIGFuIGFsZXJ0IG9iamVjdCB3aXRoIGNvcnJlY3QgaWQnLCBpbmplY3QoW0FsZXJ0U2VydmljZV0sIChzZXJ2aWNlOiBBbGVydFNlcnZpY2UpID0+IHtcbiAgICAgIHNlcnZpY2UuYWRkQWxlcnQoeyB0eXBlOiAnaW5mbycsIG1lc3NhZ2U6ICdIZWxsbyBKaGlwc3RlciBpbmZvJyB9KTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmFkZEFsZXJ0KHsgdHlwZTogJ3N1Y2Nlc3MnLCBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXIgc3VjY2VzcycgfSkpLnRvRXF1YWwoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXG4gICAgICAgICAgbWVzc2FnZTogJ0hlbGxvIEpoaXBzdGVyIHN1Y2Nlc3MnLFxuICAgICAgICAgIGlkOiAxLFxuICAgICAgICB9IGFzIEFsZXJ0KVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0KCkubGVuZ3RoKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0KClbMV0pLnRvRXF1YWwoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXG4gICAgICAgICAgbWVzc2FnZTogJ0hlbGxvIEpoaXBzdGVyIHN1Y2Nlc3MnLFxuICAgICAgICAgIGlkOiAxLFxuICAgICAgICB9IGFzIEFsZXJ0KVxuICAgICAgKTtcbiAgICB9KSk7XG5cbiAgICBpdCgnc2hvdWxkIGNsb3NlIGFuIGFsZXJ0IGNvcnJlY3RseScsIGluamVjdChbQWxlcnRTZXJ2aWNlXSwgKHNlcnZpY2U6IEFsZXJ0U2VydmljZSkgPT4ge1xuICAgICAgY29uc3QgYWxlcnQwID0gc2VydmljZS5hZGRBbGVydCh7IHR5cGU6ICdpbmZvJywgbWVzc2FnZTogJ0hlbGxvIEpoaXBzdGVyIGluZm8nIH0pO1xuICAgICAgY29uc3QgYWxlcnQxID0gc2VydmljZS5hZGRBbGVydCh7IHR5cGU6ICdpbmZvJywgbWVzc2FnZTogJ0hlbGxvIEpoaXBzdGVyIGluZm8gMicgfSk7XG4gICAgICBjb25zdCBhbGVydDIgPSBzZXJ2aWNlLmFkZEFsZXJ0KHsgdHlwZTogJ3N1Y2Nlc3MnLCBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXIgc3VjY2VzcycgfSk7XG4gICAgICBleHBlY3QoYWxlcnQyKS50b0VxdWFsKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdIZWxsbyBKaGlwc3RlciBzdWNjZXNzJyxcbiAgICAgICAgICBpZDogMixcbiAgICAgICAgfSBhcyBBbGVydClcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChzZXJ2aWNlLmdldCgpLmxlbmd0aCkudG9CZSgzKTtcbiAgICAgIGFsZXJ0MS5jbG9zZT8uKHNlcnZpY2UuZ2V0KCkpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0KCkubGVuZ3RoKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0KClbMV0pLm5vdC50b0VxdWFsKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdHlwZTogJ2luZm8nLFxuICAgICAgICAgIG1lc3NhZ2U6ICdIZWxsbyBKaGlwc3RlciBpbmZvIDInLFxuICAgICAgICAgIGlkOiAxLFxuICAgICAgICB9IGFzIEFsZXJ0KVxuICAgICAgKTtcbiAgICAgIGFsZXJ0Mi5jbG9zZT8uKHNlcnZpY2UuZ2V0KCkpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0KCkubGVuZ3RoKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0KClbMF0pLm5vdC50b0VxdWFsKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdIZWxsbyBKaGlwc3RlciBzdWNjZXNzJyxcbiAgICAgICAgICBpZDogMixcbiAgICAgICAgfSBhcyBBbGVydClcbiAgICAgICk7XG4gICAgICBhbGVydDAuY2xvc2U/LihzZXJ2aWNlLmdldCgpKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmdldCgpLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KSk7XG5cbiAgICBpdCgnc2hvdWxkIGNsb3NlIGFuIGFsZXJ0IG9uIHRpbWVvdXQgY29ycmVjdGx5JywgaW5qZWN0KFtBbGVydFNlcnZpY2VdLCAoc2VydmljZTogQWxlcnRTZXJ2aWNlKSA9PiB7XG4gICAgICBzZXJ2aWNlLmFkZEFsZXJ0KHsgdHlwZTogJ2luZm8nLCBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXIgaW5mbycgfSk7XG5cbiAgICAgIGV4cGVjdChzZXJ2aWNlLmdldCgpLmxlbmd0aCkudG9CZSgxKTtcblxuICAgICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDYwMDApO1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5nZXQoKS5sZW5ndGgpLnRvQmUoMCk7XG4gICAgfSkpO1xuXG4gICAgaXQoJ3Nob3VsZCBjbGVhciBhbGVydHMnLCBpbmplY3QoW0FsZXJ0U2VydmljZV0sIChzZXJ2aWNlOiBBbGVydFNlcnZpY2UpID0+IHtcbiAgICAgIHNlcnZpY2UuYWRkQWxlcnQoeyB0eXBlOiAnaW5mbycsIG1lc3NhZ2U6ICdIZWxsbyBKaGlwc3RlciBpbmZvJyB9KTtcbiAgICAgIHNlcnZpY2UuYWRkQWxlcnQoeyB0eXBlOiAnZGFuZ2VyJywgbWVzc2FnZTogJ0hlbGxvIEpoaXBzdGVyIGluZm8nIH0pO1xuICAgICAgc2VydmljZS5hZGRBbGVydCh7IHR5cGU6ICdzdWNjZXNzJywgbWVzc2FnZTogJ0hlbGxvIEpoaXBzdGVyIGluZm8nIH0pO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0KCkubGVuZ3RoKS50b0JlKDMpO1xuICAgICAgc2VydmljZS5jbGVhcigpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0KCkubGVuZ3RoKS50b0JlKDApO1xuICAgIH0pKTtcblxuICAgIGl0KCdzaG91bGQgcHJvZHVjZSBhIHNjb3BlZCBhbGVydCcsIGluamVjdChbQWxlcnRTZXJ2aWNlXSwgKHNlcnZpY2U6IEFsZXJ0U2VydmljZSkgPT4ge1xuICAgICAgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLmFkZEFsZXJ0KFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdIZWxsbyBKaGlwc3RlcicsXG4gICAgICAgICAgICB0aW1lb3V0OiAzMDAwLFxuICAgICAgICAgICAgdG9hc3Q6IHRydWUsXG4gICAgICAgICAgICBwb3NpdGlvbjogJ3RvcCBsZWZ0JyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIFtdXG4gICAgICAgIClcbiAgICAgICkudG9FcXVhbChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXInLFxuICAgICAgICAgIGlkOiAwLFxuICAgICAgICAgIHRpbWVvdXQ6IDMwMDAsXG4gICAgICAgICAgdG9hc3Q6IHRydWUsXG4gICAgICAgICAgcG9zaXRpb246ICd0b3AgbGVmdCcsXG4gICAgICAgIH0gYXMgQWxlcnQpXG4gICAgICApO1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5nZXQoKS5sZW5ndGgpLnRvQmUoMCk7XG4gICAgfSkpO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm9kdWNlIGEgc3VjY2VzcyBtZXNzYWdlJywgaW5qZWN0KFtBbGVydFNlcnZpY2VdLCAoc2VydmljZTogQWxlcnRTZXJ2aWNlKSA9PiB7XG4gICAgICBleHBlY3Qoc2VydmljZS5hZGRBbGVydCh7IHR5cGU6ICdzdWNjZXNzJywgbWVzc2FnZTogJ0hlbGxvIEpoaXBzdGVyJyB9KSkudG9FcXVhbChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXInLFxuICAgICAgICB9IGFzIEFsZXJ0KVxuICAgICAgKTtcbiAgICB9KSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb2R1Y2UgYSBzdWNjZXNzIG1lc3NhZ2Ugd2l0aCBjdXN0b20gcG9zaXRpb24nLCBpbmplY3QoW0FsZXJ0U2VydmljZV0sIChzZXJ2aWNlOiBBbGVydFNlcnZpY2UpID0+IHtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmFkZEFsZXJ0KHsgdHlwZTogJ3N1Y2Nlc3MnLCBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXInLCBwb3NpdGlvbjogJ2JvdHRvbSBsZWZ0JyB9KSkudG9FcXVhbChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXInLFxuICAgICAgICAgIHBvc2l0aW9uOiAnYm90dG9tIGxlZnQnLFxuICAgICAgICB9IGFzIEFsZXJ0KVxuICAgICAgKTtcbiAgICB9KSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb2R1Y2UgYSBlcnJvciBtZXNzYWdlJywgaW5qZWN0KFtBbGVydFNlcnZpY2VdLCAoc2VydmljZTogQWxlcnRTZXJ2aWNlKSA9PiB7XG4gICAgICBleHBlY3Qoc2VydmljZS5hZGRBbGVydCh7IHR5cGU6ICdkYW5nZXInLCBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXInIH0pKS50b0VxdWFsKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdHlwZTogJ2RhbmdlcicsXG4gICAgICAgICAgbWVzc2FnZTogJ0hlbGxvIEpoaXBzdGVyJyxcbiAgICAgICAgfSBhcyBBbGVydClcbiAgICAgICk7XG4gICAgfSkpO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm9kdWNlIGEgd2FybmluZyBtZXNzYWdlJywgaW5qZWN0KFtBbGVydFNlcnZpY2VdLCAoc2VydmljZTogQWxlcnRTZXJ2aWNlKSA9PiB7XG4gICAgICBleHBlY3Qoc2VydmljZS5hZGRBbGVydCh7IHR5cGU6ICd3YXJuaW5nJywgbWVzc2FnZTogJ0hlbGxvIEpoaXBzdGVyJyB9KSkudG9FcXVhbChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXInLFxuICAgICAgICB9IGFzIEFsZXJ0KVxuICAgICAgKTtcbiAgICB9KSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb2R1Y2UgYSBpbmZvIG1lc3NhZ2UnLCBpbmplY3QoW0FsZXJ0U2VydmljZV0sIChzZXJ2aWNlOiBBbGVydFNlcnZpY2UpID0+IHtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmFkZEFsZXJ0KHsgdHlwZTogJ2luZm8nLCBtZXNzYWdlOiAnSGVsbG8gSmhpcHN0ZXInIH0pKS50b0VxdWFsKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdHlwZTogJ2luZm8nLFxuICAgICAgICAgIG1lc3NhZ2U6ICdIZWxsbyBKaGlwc3RlcicsXG4gICAgICAgIH0gYXMgQWxlcnQpXG4gICAgICApO1xuICAgIH0pKTtcblxuICAgIGl0KCdzaG91bGQgcHJvZHVjZSBhIGluZm8gbWVzc2FnZSB3aXRoIHRyYW5zbGF0ZWQgbWVzc2FnZSBpZiBrZXkgZXhpc3RzJywgaW5qZWN0KFxuICAgICAgW0FsZXJ0U2VydmljZSwgVHJhbnNsYXRlU2VydmljZV0sXG4gICAgICAoc2VydmljZTogQWxlcnRTZXJ2aWNlLCB0cmFuc2xhdGVTZXJ2aWNlOiBUcmFuc2xhdGVTZXJ2aWNlKSA9PiB7XG4gICAgICAgIHRyYW5zbGF0ZVNlcnZpY2Uuc2V0VHJhbnNsYXRpb24oJ2VuJywge1xuICAgICAgICAgICdoZWxsby5qaGlwc3Rlcic6ICdUcmFuc2xhdGVkIG1lc3NhZ2UnLFxuICAgICAgICB9KTtcbiAgICAgICAgZXhwZWN0KHNlcnZpY2UuYWRkQWxlcnQoeyB0eXBlOiAnaW5mbycsIG1lc3NhZ2U6ICdIZWxsbyBKaGlwc3RlcicsIHRyYW5zbGF0aW9uS2V5OiAnaGVsbG8uamhpcHN0ZXInIH0pKS50b0VxdWFsKFxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIHR5cGU6ICdpbmZvJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdUcmFuc2xhdGVkIG1lc3NhZ2UnLFxuICAgICAgICAgIH0gYXMgQWxlcnQpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgKSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb2R1Y2UgYSBpbmZvIG1lc3NhZ2Ugd2l0aCBwcm92aWRlZCBtZXNzYWdlIGlmIGtleSBkb2VzIG5vdCBleGlzdHMnLCBpbmplY3QoXG4gICAgICBbQWxlcnRTZXJ2aWNlLCBUcmFuc2xhdGVTZXJ2aWNlXSxcbiAgICAgIChzZXJ2aWNlOiBBbGVydFNlcnZpY2UpID0+IHtcbiAgICAgICAgZXhwZWN0KHNlcnZpY2UuYWRkQWxlcnQoeyB0eXBlOiAnaW5mbycsIG1lc3NhZ2U6ICdIZWxsbyBKaGlwc3RlcicsIHRyYW5zbGF0aW9uS2V5OiAnaGVsbG8uamhpcHN0ZXInIH0pKS50b0VxdWFsKFxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIHR5cGU6ICdpbmZvJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdIZWxsbyBKaGlwc3RlcicsXG4gICAgICAgICAgfSBhcyBBbGVydClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICApKTtcblxuICAgIGl0KCdzaG91bGQgcHJvZHVjZSBhIGluZm8gbWVzc2FnZSB3aXRoIHByb3ZpZGVkIGtleSBpZiB0cmFuc2x0aW9uIGtleSBkb2VzIG5vdCBleGlzdCBpbiB0cmFuc2xhdGlvbnMgYW5kIG1lc3NhZ2UgaXMgbm90IHByb3ZpZGVkJywgaW5qZWN0KFxuICAgICAgW0FsZXJ0U2VydmljZSwgVHJhbnNsYXRlU2VydmljZV0sXG4gICAgICAoc2VydmljZTogQWxlcnRTZXJ2aWNlKSA9PiB7XG4gICAgICAgIGV4cGVjdChzZXJ2aWNlLmFkZEFsZXJ0KHsgdHlwZTogJ2luZm8nLCB0cmFuc2xhdGlvbktleTogJ2hlbGxvLmpoaXBzdGVyJyB9KSkudG9FcXVhbChcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICB0eXBlOiAnaW5mbycsXG4gICAgICAgICAgICBtZXNzYWdlOiAnaGVsbG8uamhpcHN0ZXInLFxuICAgICAgICAgIH0gYXMgQWxlcnQpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgKSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=