2574eb6dd0447cea3cb25f3750eae34f
"use strict";

/* istanbul ignore next */
function cov_jdy5rur6u() {
  var path = "C:\\Users\\Nicolas\\Desktop\\test6\\gateway\\src\\main\\webapp\\app\\core\\auth\\account.service.ts";
  var hash = "e0a55961f8c4ac6cfac6069567502226224e8ac5";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "C:\\Users\\Nicolas\\Desktop\\test6\\gateway\\src\\main\\webapp\\app\\core\\auth\\account.service.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 2,
          column: 62
        }
      },
      "1": {
        start: {
          line: 3,
          column: 0
        },
        end: {
          line: 3,
          column: 32
        }
      },
      "2": {
        start: {
          line: 4,
          column: 16
        },
        end: {
          line: 4,
          column: 32
        }
      },
      "3": {
        start: {
          line: 5,
          column: 15
        },
        end: {
          line: 5,
          column: 39
        }
      },
      "4": {
        start: {
          line: 6,
          column: 17
        },
        end: {
          line: 6,
          column: 43
        }
      },
      "5": {
        start: {
          line: 7,
          column: 15
        },
        end: {
          line: 7,
          column: 46
        }
      },
      "6": {
        start: {
          line: 8,
          column: 15
        },
        end: {
          line: 8,
          column: 45
        }
      },
      "7": {
        start: {
          line: 9,
          column: 25
        },
        end: {
          line: 9,
          column: 50
        }
      },
      "8": {
        start: {
          line: 10,
          column: 15
        },
        end: {
          line: 10,
          column: 30
        }
      },
      "9": {
        start: {
          line: 11,
          column: 20
        },
        end: {
          line: 11,
          column: 45
        }
      },
      "10": {
        start: {
          line: 12,
          column: 32
        },
        end: {
          line: 12,
          column: 78
        }
      },
      "11": {
        start: {
          line: 13,
          column: 37
        },
        end: {
          line: 13,
          column: 84
        }
      },
      "12": {
        start: {
          line: 14,
          column: 21
        },
        end: {
          line: 77,
          column: 1
        }
      },
      "13": {
        start: {
          line: 16,
          column: 8
        },
        end: {
          line: 16,
          column: 49
        }
      },
      "14": {
        start: {
          line: 17,
          column: 8
        },
        end: {
          line: 17,
          column: 59
        }
      },
      "15": {
        start: {
          line: 18,
          column: 8
        },
        end: {
          line: 18,
          column: 25
        }
      },
      "16": {
        start: {
          line: 19,
          column: 8
        },
        end: {
          line: 19,
          column: 55
        }
      },
      "17": {
        start: {
          line: 20,
          column: 8
        },
        end: {
          line: 20,
          column: 29
        }
      },
      "18": {
        start: {
          line: 21,
          column: 8
        },
        end: {
          line: 21,
          column: 65
        }
      },
      "19": {
        start: {
          line: 22,
          column: 8
        },
        end: {
          line: 22,
          column: 33
        }
      },
      "20": {
        start: {
          line: 23,
          column: 8
        },
        end: {
          line: 23,
          column: 63
        }
      },
      "21": {
        start: {
          line: 26,
          column: 8
        },
        end: {
          line: 26,
          column: 100
        }
      },
      "22": {
        start: {
          line: 29,
          column: 8
        },
        end: {
          line: 29,
          column: 37
        }
      },
      "23": {
        start: {
          line: 30,
          column: 8
        },
        end: {
          line: 30,
          column: 57
        }
      },
      "24": {
        start: {
          line: 31,
          column: 8
        },
        end: {
          line: 33,
          column: 9
        }
      },
      "25": {
        start: {
          line: 32,
          column: 12
        },
        end: {
          line: 32,
          column: 38
        }
      },
      "26": {
        start: {
          line: 36,
          column: 8
        },
        end: {
          line: 38,
          column: 9
        }
      },
      "27": {
        start: {
          line: 37,
          column: 12
        },
        end: {
          line: 37,
          column: 25
        }
      },
      "28": {
        start: {
          line: 39,
          column: 8
        },
        end: {
          line: 41,
          column: 9
        }
      },
      "29": {
        start: {
          line: 40,
          column: 12
        },
        end: {
          line: 40,
          column: 40
        }
      },
      "30": {
        start: {
          line: 42,
          column: 8
        },
        end: {
          line: 42,
          column: 98
        }
      },
      "31": {
        start: {
          line: 42,
          column: 65
        },
        end: {
          line: 42,
          column: 96
        }
      },
      "32": {
        start: {
          line: 45,
          column: 8
        },
        end: {
          line: 56,
          column: 9
        }
      },
      "33": {
        start: {
          line: 46,
          column: 12
        },
        end: {
          line: 55,
          column: 43
        }
      },
      "34": {
        start: {
          line: 47,
          column: 16
        },
        end: {
          line: 47,
          column: 43
        }
      },
      "35": {
        start: {
          line: 51,
          column: 16
        },
        end: {
          line: 53,
          column: 17
        }
      },
      "36": {
        start: {
          line: 52,
          column: 20
        },
        end: {
          line: 52,
          column: 63
        }
      },
      "37": {
        start: {
          line: 54,
          column: 16
        },
        end: {
          line: 54,
          column: 43
        }
      },
      "38": {
        start: {
          line: 57,
          column: 8
        },
        end: {
          line: 57,
          column: 86
        }
      },
      "39": {
        start: {
          line: 57,
          column: 68
        },
        end: {
          line: 57,
          column: 83
        }
      },
      "40": {
        start: {
          line: 60,
          column: 8
        },
        end: {
          line: 60,
          column: 42
        }
      },
      "41": {
        start: {
          line: 63,
          column: 8
        },
        end: {
          line: 63,
          column: 55
        }
      },
      "42": {
        start: {
          line: 66,
          column: 8
        },
        end: {
          line: 66,
          column: 90
        }
      },
      "43": {
        start: {
          line: 71,
          column: 28
        },
        end: {
          line: 71,
          column: 61
        }
      },
      "44": {
        start: {
          line: 72,
          column: 8
        },
        end: {
          line: 75,
          column: 9
        }
      },
      "45": {
        start: {
          line: 73,
          column: 12
        },
        end: {
          line: 73,
          column: 48
        }
      },
      "46": {
        start: {
          line: 74,
          column: 12
        },
        end: {
          line: 74,
          column: 51
        }
      },
      "47": {
        start: {
          line: 78,
          column: 0
        },
        end: {
          line: 85,
          column: 2
        }
      },
      "48": {
        start: {
          line: 78,
          column: 38
        },
        end: {
          line: 85,
          column: 1
        }
      },
      "49": {
        start: {
          line: 86,
          column: 0
        },
        end: {
          line: 94,
          column: 19
        }
      },
      "50": {
        start: {
          line: 95,
          column: 0
        },
        end: {
          line: 95,
          column: 40
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 15,
            column: 4
          },
          end: {
            line: 15,
            column: 5
          }
        },
        loc: {
          start: {
            line: 15,
            column: 118
          },
          end: {
            line: 24,
            column: 5
          }
        },
        line: 15
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 25,
            column: 4
          },
          end: {
            line: 25,
            column: 5
          }
        },
        loc: {
          start: {
            line: 25,
            column: 18
          },
          end: {
            line: 27,
            column: 5
          }
        },
        line: 25
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 28,
            column: 4
          },
          end: {
            line: 28,
            column: 5
          }
        },
        loc: {
          start: {
            line: 28,
            column: 27
          },
          end: {
            line: 34,
            column: 5
          }
        },
        line: 28
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 35,
            column: 4
          },
          end: {
            line: 35,
            column: 5
          }
        },
        loc: {
          start: {
            line: 35,
            column: 33
          },
          end: {
            line: 43,
            column: 5
          }
        },
        line: 35
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 42,
            column: 50
          },
          end: {
            line: 42,
            column: 51
          }
        },
        loc: {
          start: {
            line: 42,
            column: 65
          },
          end: {
            line: 42,
            column: 96
          }
        },
        line: 42
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 44,
            column: 4
          },
          end: {
            line: 44,
            column: 5
          }
        },
        loc: {
          start: {
            line: 44,
            column: 20
          },
          end: {
            line: 58,
            column: 5
          }
        },
        line: 44
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 46,
            column: 67
          },
          end: {
            line: 46,
            column: 68
          }
        },
        loc: {
          start: {
            line: 46,
            column: 80
          },
          end: {
            line: 55,
            column: 13
          }
        },
        line: 46
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 57,
            column: 62
          },
          end: {
            line: 57,
            column: 63
          }
        },
        loc: {
          start: {
            line: 57,
            column: 68
          },
          end: {
            line: 57,
            column: 83
          }
        },
        line: 57
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 59,
            column: 4
          },
          end: {
            line: 59,
            column: 5
          }
        },
        loc: {
          start: {
            line: 59,
            column: 22
          },
          end: {
            line: 61,
            column: 5
          }
        },
        line: 59
      },
      "9": {
        name: "(anonymous_9)",
        decl: {
          start: {
            line: 62,
            column: 4
          },
          end: {
            line: 62,
            column: 5
          }
        },
        loc: {
          start: {
            line: 62,
            column: 29
          },
          end: {
            line: 64,
            column: 5
          }
        },
        line: 62
      },
      "10": {
        name: "(anonymous_10)",
        decl: {
          start: {
            line: 65,
            column: 4
          },
          end: {
            line: 65,
            column: 5
          }
        },
        loc: {
          start: {
            line: 65,
            column: 12
          },
          end: {
            line: 67,
            column: 5
          }
        },
        line: 65
      },
      "11": {
        name: "(anonymous_11)",
        decl: {
          start: {
            line: 68,
            column: 4
          },
          end: {
            line: 68,
            column: 5
          }
        },
        loc: {
          start: {
            line: 68,
            column: 26
          },
          end: {
            line: 76,
            column: 5
          }
        },
        line: 68
      },
      "12": {
        name: "(anonymous_12)",
        decl: {
          start: {
            line: 78,
            column: 32
          },
          end: {
            line: 78,
            column: 33
          }
        },
        loc: {
          start: {
            line: 78,
            column: 38
          },
          end: {
            line: 85,
            column: 1
          }
        },
        line: 78
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 31,
            column: 8
          },
          end: {
            line: 33,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 31,
            column: 8
          },
          end: {
            line: 33,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 31
      },
      "1": {
        loc: {
          start: {
            line: 36,
            column: 8
          },
          end: {
            line: 38,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 36,
            column: 8
          },
          end: {
            line: 38,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 36
      },
      "2": {
        loc: {
          start: {
            line: 39,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 39,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 39
      },
      "3": {
        loc: {
          start: {
            line: 45,
            column: 8
          },
          end: {
            line: 56,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 45,
            column: 8
          },
          end: {
            line: 56,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 45
      },
      "4": {
        loc: {
          start: {
            line: 45,
            column: 12
          },
          end: {
            line: 45,
            column: 40
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 45,
            column: 12
          },
          end: {
            line: 45,
            column: 31
          }
        }, {
          start: {
            line: 45,
            column: 35
          },
          end: {
            line: 45,
            column: 40
          }
        }],
        line: 45
      },
      "5": {
        loc: {
          start: {
            line: 51,
            column: 16
          },
          end: {
            line: 53,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 51,
            column: 16
          },
          end: {
            line: 53,
            column: 17
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 51
      },
      "6": {
        loc: {
          start: {
            line: 72,
            column: 8
          },
          end: {
            line: 75,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 72,
            column: 8
          },
          end: {
            line: 75,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 72
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0]
    },
    inputSourceMap: {
      file: "C:\\Users\\Nicolas\\Desktop\\test6\\gateway\\src\\main\\webapp\\app\\core\\auth\\account.service.ts",
      mappings: "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",
      names: [],
      sources: ["C:\\Users\\Nicolas\\Desktop\\test6\\gateway\\src\\main\\webapp\\app\\core\\auth\\account.service.ts"],
      sourcesContent: ["import { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { HttpClient } from '@angular/common/http';\nimport { TranslateService } from '@ngx-translate/core';\nimport { SessionStorageService } from 'ngx-webstorage';\nimport { Observable, ReplaySubject, of } from 'rxjs';\nimport { shareReplay, tap, catchError } from 'rxjs/operators';\n\nimport { StateStorageService } from 'app/core/auth/state-storage.service';\nimport { ApplicationConfigService } from '../config/application-config.service';\nimport { Account } from 'app/core/auth/account.model';\n\n@Injectable({ providedIn: 'root' })\nexport class AccountService {\n  private userIdentity: Account | null = null;\n  private authenticationState = new ReplaySubject<Account | null>(1);\n  private accountCache$?: Observable<Account> | null;\n\n  constructor(\n    private translateService: TranslateService,\n    private sessionStorageService: SessionStorageService,\n    private http: HttpClient,\n    private stateStorageService: StateStorageService,\n    private router: Router,\n    private applicationConfigService: ApplicationConfigService\n  ) {}\n\n  save(account: Account): Observable<{}> {\n    return this.http.post(this.applicationConfigService.getEndpointFor('api/account'), account);\n  }\n\n  authenticate(identity: Account | null): void {\n    this.userIdentity = identity;\n    this.authenticationState.next(this.userIdentity);\n    if (!identity) {\n      this.accountCache$ = null;\n    }\n  }\n\n  hasAnyAuthority(authorities: string[] | string): boolean {\n    if (!this.userIdentity) {\n      return false;\n    }\n    if (!Array.isArray(authorities)) {\n      authorities = [authorities];\n    }\n    return this.userIdentity.authorities.some((authority: string) => authorities.includes(authority));\n  }\n\n  identity(force?: boolean): Observable<Account | null> {\n    if (!this.accountCache$ || force) {\n      this.accountCache$ = this.fetch().pipe(\n        tap((account: Account) => {\n          this.authenticate(account);\n\n          // After retrieve the account info, the language will be changed to\n          // the user's preferred language configured in the account setting\n          // unless user have choosed other language in the current session\n          if (!this.sessionStorageService.retrieve('locale')) {\n            this.translateService.use(account.langKey);\n          }\n\n          this.navigateToStoredUrl();\n        }),\n        shareReplay()\n      );\n    }\n    return this.accountCache$.pipe(catchError(() => of(null)));\n  }\n\n  isAuthenticated(): boolean {\n    return this.userIdentity !== null;\n  }\n\n  getAuthenticationState(): Observable<Account | null> {\n    return this.authenticationState.asObservable();\n  }\n\n  private fetch(): Observable<Account> {\n    return this.http.get<Account>(this.applicationConfigService.getEndpointFor('api/account'));\n  }\n\n  private navigateToStoredUrl(): void {\n    // previousState can be set in the authExpiredInterceptor and in the userRouteAccessService\n    // if login is successful, go to stored previousState and clear previousState\n    const previousUrl = this.stateStorageService.getUrl();\n    if (previousUrl) {\n      this.stateStorageService.clearUrl();\n      this.router.navigateByUrl(previousUrl);\n    }\n  }\n}\n"],
      version: 3
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "e0a55961f8c4ac6cfac6069567502226224e8ac5"
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }

  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_jdy5rur6u = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}

cov_jdy5rur6u();
cov_jdy5rur6u().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});

/* istanbul ignore next */
cov_jdy5rur6u().s[1]++;
exports.AccountService = void 0;
const tslib_1 =
/* istanbul ignore next */
(cov_jdy5rur6u().s[2]++, require("tslib"));
const core_1 =
/* istanbul ignore next */
(cov_jdy5rur6u().s[3]++, require("@angular/core"));
const router_1 =
/* istanbul ignore next */
(cov_jdy5rur6u().s[4]++, require("@angular/router"));
const http_1 =
/* istanbul ignore next */
(cov_jdy5rur6u().s[5]++, require("@angular/common/http"));
const core_2 =
/* istanbul ignore next */
(cov_jdy5rur6u().s[6]++, require("@ngx-translate/core"));
const ngx_webstorage_1 =
/* istanbul ignore next */
(cov_jdy5rur6u().s[7]++, require("ngx-webstorage"));
const rxjs_1 =
/* istanbul ignore next */
(cov_jdy5rur6u().s[8]++, require("rxjs"));
const operators_1 =
/* istanbul ignore next */
(cov_jdy5rur6u().s[9]++, require("rxjs/operators"));
const state_storage_service_1 =
/* istanbul ignore next */
(cov_jdy5rur6u().s[10]++, require("app/core/auth/state-storage.service"));
const application_config_service_1 =
/* istanbul ignore next */
(cov_jdy5rur6u().s[11]++, require("../config/application-config.service"));

/* istanbul ignore next */
cov_jdy5rur6u().s[12]++;
let AccountService = class AccountService {
  constructor(translateService, sessionStorageService, http, stateStorageService, router, applicationConfigService) {
    /* istanbul ignore next */
    cov_jdy5rur6u().f[0]++;
    cov_jdy5rur6u().s[13]++;
    this.translateService = translateService;

    /* istanbul ignore next */
    cov_jdy5rur6u().s[14]++;
    this.sessionStorageService = sessionStorageService;

    /* istanbul ignore next */
    cov_jdy5rur6u().s[15]++;
    this.http = http;

    /* istanbul ignore next */
    cov_jdy5rur6u().s[16]++;
    this.stateStorageService = stateStorageService;

    /* istanbul ignore next */
    cov_jdy5rur6u().s[17]++;
    this.router = router;

    /* istanbul ignore next */
    cov_jdy5rur6u().s[18]++;
    this.applicationConfigService = applicationConfigService;

    /* istanbul ignore next */
    cov_jdy5rur6u().s[19]++;
    this.userIdentity = null;

    /* istanbul ignore next */
    cov_jdy5rur6u().s[20]++;
    this.authenticationState = new rxjs_1.ReplaySubject(1);
  }

  save(account) {
    /* istanbul ignore next */
    cov_jdy5rur6u().f[1]++;
    cov_jdy5rur6u().s[21]++;
    return this.http.post(this.applicationConfigService.getEndpointFor('api/account'), account);
  }

  authenticate(identity) {
    /* istanbul ignore next */
    cov_jdy5rur6u().f[2]++;
    cov_jdy5rur6u().s[22]++;
    this.userIdentity = identity;

    /* istanbul ignore next */
    cov_jdy5rur6u().s[23]++;
    this.authenticationState.next(this.userIdentity);

    /* istanbul ignore next */
    cov_jdy5rur6u().s[24]++;

    if (!identity) {
      /* istanbul ignore next */
      cov_jdy5rur6u().b[0][0]++;
      cov_jdy5rur6u().s[25]++;
      this.accountCache$ = null;
    } else
    /* istanbul ignore next */
    {
      cov_jdy5rur6u().b[0][1]++;
    }
  }

  hasAnyAuthority(authorities) {
    /* istanbul ignore next */
    cov_jdy5rur6u().f[3]++;
    cov_jdy5rur6u().s[26]++;

    if (!this.userIdentity) {
      /* istanbul ignore next */
      cov_jdy5rur6u().b[1][0]++;
      cov_jdy5rur6u().s[27]++;
      return false;
    } else
    /* istanbul ignore next */
    {
      cov_jdy5rur6u().b[1][1]++;
    }

    cov_jdy5rur6u().s[28]++;

    if (!Array.isArray(authorities)) {
      /* istanbul ignore next */
      cov_jdy5rur6u().b[2][0]++;
      cov_jdy5rur6u().s[29]++;
      authorities = [authorities];
    } else
    /* istanbul ignore next */
    {
      cov_jdy5rur6u().b[2][1]++;
    }

    cov_jdy5rur6u().s[30]++;
    return this.userIdentity.authorities.some((authority) => {
      /* istanbul ignore next */
      cov_jdy5rur6u().f[4]++;
      cov_jdy5rur6u().s[31]++;
      return authorities.includes(authority);
    });
  }

  identity(force) {
    /* istanbul ignore next */
    cov_jdy5rur6u().f[5]++;
    cov_jdy5rur6u().s[32]++;

    if (
    /* istanbul ignore next */
    (cov_jdy5rur6u().b[4][0]++, !this.accountCache$) ||
    /* istanbul ignore next */
    (cov_jdy5rur6u().b[4][1]++, force)) {
      /* istanbul ignore next */
      cov_jdy5rur6u().b[3][0]++;
      cov_jdy5rur6u().s[33]++;
      this.accountCache$ = this.fetch().pipe(operators_1.tap((account) => {
        /* istanbul ignore next */
        cov_jdy5rur6u().f[6]++;
        cov_jdy5rur6u().s[34]++;
        this.authenticate(account); // After retrieve the account info, the language will be changed to
        // the user's preferred language configured in the account setting
        // unless user have choosed other language in the current session

        /* istanbul ignore next */
        cov_jdy5rur6u().s[35]++;

        if (!this.sessionStorageService.retrieve('locale')) {
          /* istanbul ignore next */
          cov_jdy5rur6u().b[5][0]++;
          cov_jdy5rur6u().s[36]++;
          this.translateService.use(account.langKey);
        } else
        /* istanbul ignore next */
        {
          cov_jdy5rur6u().b[5][1]++;
        }

        cov_jdy5rur6u().s[37]++;
        this.navigateToStoredUrl();
      }), operators_1.shareReplay());
    } else
    /* istanbul ignore next */
    {
      cov_jdy5rur6u().b[3][1]++;
    }

    cov_jdy5rur6u().s[38]++;
    return this.accountCache$.pipe(operators_1.catchError(() => {
      /* istanbul ignore next */
      cov_jdy5rur6u().f[7]++;
      cov_jdy5rur6u().s[39]++;
      return rxjs_1.of(null);
    }));
  }

  isAuthenticated() {
    /* istanbul ignore next */
    cov_jdy5rur6u().f[8]++;
    cov_jdy5rur6u().s[40]++;
    return this.userIdentity !== null;
  }

  getAuthenticationState() {
    /* istanbul ignore next */
    cov_jdy5rur6u().f[9]++;
    cov_jdy5rur6u().s[41]++;
    return this.authenticationState.asObservable();
  }

  fetch() {
    /* istanbul ignore next */
    cov_jdy5rur6u().f[10]++;
    cov_jdy5rur6u().s[42]++;
    return this.http.get(this.applicationConfigService.getEndpointFor('api/account'));
  }

  navigateToStoredUrl() {
    /* istanbul ignore next */
    cov_jdy5rur6u().f[11]++;
    // previousState can be set in the authExpiredInterceptor and in the userRouteAccessService
    // if login is successful, go to stored previousState and clear previousState
    const previousUrl =
    /* istanbul ignore next */
    (cov_jdy5rur6u().s[43]++, this.stateStorageService.getUrl());

    /* istanbul ignore next */
    cov_jdy5rur6u().s[44]++;

    if (previousUrl) {
      /* istanbul ignore next */
      cov_jdy5rur6u().b[6][0]++;
      cov_jdy5rur6u().s[45]++;
      this.stateStorageService.clearUrl();

      /* istanbul ignore next */
      cov_jdy5rur6u().s[46]++;
      this.router.navigateByUrl(previousUrl);
    } else
    /* istanbul ignore next */
    {
      cov_jdy5rur6u().b[6][1]++;
    }
  }

};

/* istanbul ignore next */
cov_jdy5rur6u().s[47]++;

AccountService.ctorParameters = () => {
  /* istanbul ignore next */
  cov_jdy5rur6u().f[12]++;
  cov_jdy5rur6u().s[48]++;
  return [{
    type: core_2.TranslateService
  }, {
    type: ngx_webstorage_1.SessionStorageService
  }, {
    type: http_1.HttpClient
  }, {
    type: state_storage_service_1.StateStorageService
  }, {
    type: router_1.Router
  }, {
    type: application_config_service_1.ApplicationConfigService
  }];
};

/* istanbul ignore next */
cov_jdy5rur6u().s[49]++;
AccountService = tslib_1.__decorate([core_1.Injectable({
  providedIn: 'root'
}), tslib_1.__metadata("design:paramtypes", [core_2.TranslateService, ngx_webstorage_1.SessionStorageService, http_1.HttpClient, state_storage_service_1.StateStorageService, router_1.Router, application_config_service_1.ApplicationConfigService])], AccountService);

/* istanbul ignore next */
cov_jdy5rur6u().s[50]++;
exports.AccountService = AccountService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcTmljb2xhc1xcRGVza3RvcFxcdGVzdDZcXGdhdGV3YXlcXHNyY1xcbWFpblxcd2ViYXBwXFxhcHBcXGNvcmVcXGF1dGhcXGFjY291bnQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbUJZOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW5CWixNQUFBLE1BQUE7QUFBQTtBQUFBLHlCQUFBLE9BQUEsQ0FBQSxlQUFBLENBQUEsQ0FBQTtBQUNBLE1BQUEsUUFBQTtBQUFBO0FBQUEseUJBQUEsT0FBQSxDQUFBLGlCQUFBLENBQUEsQ0FBQTtBQUNBLE1BQUEsTUFBQTtBQUFBO0FBQUEseUJBQUEsT0FBQSxDQUFBLHNCQUFBLENBQUEsQ0FBQTtBQUNBLE1BQUEsTUFBQTtBQUFBO0FBQUEseUJBQUEsT0FBQSxDQUFBLHFCQUFBLENBQUEsQ0FBQTtBQUNBLE1BQUEsZ0JBQUE7QUFBQTtBQUFBLHlCQUFBLE9BQUEsQ0FBQSxnQkFBQSxDQUFBLENBQUE7QUFDQSxNQUFBLE1BQUE7QUFBQTtBQUFBLHlCQUFBLE9BQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtBQUNBLE1BQUEsV0FBQTtBQUFBO0FBQUEseUJBQUEsT0FBQSxDQUFBLGdCQUFBLENBQUEsQ0FBQTtBQUVBLE1BQUEsdUJBQUE7QUFBQTtBQUFBLDBCQUFBLE9BQUEsQ0FBQSxxQ0FBQSxDQUFBLENBQUE7QUFD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LENBQUE7O1VBUUEsNEJBQUEsQ0FBQTs7Ozs7O0FBSUksY0FBYyxHQUFBLE9BQUEsQ0FBQSxVQUFBLENBQUEsQ0FEMUIsTUFBQSxDQUFBLFVBQUEsQ0FBVztBQUFFLEVBQUEsVUFBVSxFQUFFO0FBQWQsQ0FBWCxDQUMwQixFLHlDQU1HLE1BQUEsQ0FBQSxnQixFQUNLLGdCQUFBLENBQUEscUIsRUFDakIsTUFBQSxDQUFBLFUsRUFDZSx1QkFBQSxDQUFBLG1CLEVBQ2IsUUFBQSxDQUFBLE0sRUFDa0IsNEJBQUEsQ0FBQSx3QixFQVhYLENBQUEsRUFBZCxjQUFjLENBQWQ7Ozs7QUFBQSxPQUFBLENBQUEsY0FBQSxHQUFBLGNBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IFNlc3Npb25TdG9yYWdlU2VydmljZSB9IGZyb20gJ25neC13ZWJzdG9yYWdlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIFJlcGxheVN1YmplY3QsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBzaGFyZVJlcGxheSwgdGFwLCBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBTdGF0ZVN0b3JhZ2VTZXJ2aWNlIH0gZnJvbSAnYXBwL2NvcmUvYXV0aC9zdGF0ZS1zdG9yYWdlLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXBwbGljYXRpb25Db25maWdTZXJ2aWNlIH0gZnJvbSAnLi4vY29uZmlnL2FwcGxpY2F0aW9uLWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7IEFjY291bnQgfSBmcm9tICdhcHAvY29yZS9hdXRoL2FjY291bnQubW9kZWwnO1xuXG5ASW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KVxuZXhwb3J0IGNsYXNzIEFjY291bnRTZXJ2aWNlIHtcbiAgcHJpdmF0ZSB1c2VySWRlbnRpdHk6IEFjY291bnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBhdXRoZW50aWNhdGlvblN0YXRlID0gbmV3IFJlcGxheVN1YmplY3Q8QWNjb3VudCB8IG51bGw+KDEpO1xuICBwcml2YXRlIGFjY291bnRDYWNoZSQ/OiBPYnNlcnZhYmxlPEFjY291bnQ+IHwgbnVsbDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHRyYW5zbGF0ZVNlcnZpY2U6IFRyYW5zbGF0ZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBzZXNzaW9uU3RvcmFnZVNlcnZpY2U6IFNlc3Npb25TdG9yYWdlU2VydmljZSxcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXG4gICAgcHJpdmF0ZSBzdGF0ZVN0b3JhZ2VTZXJ2aWNlOiBTdGF0ZVN0b3JhZ2VTZXJ2aWNlLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgcHJpdmF0ZSBhcHBsaWNhdGlvbkNvbmZpZ1NlcnZpY2U6IEFwcGxpY2F0aW9uQ29uZmlnU2VydmljZVxuICApIHt9XG5cbiAgc2F2ZShhY2NvdW50OiBBY2NvdW50KTogT2JzZXJ2YWJsZTx7fT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdCh0aGlzLmFwcGxpY2F0aW9uQ29uZmlnU2VydmljZS5nZXRFbmRwb2ludEZvcignYXBpL2FjY291bnQnKSwgYWNjb3VudCk7XG4gIH1cblxuICBhdXRoZW50aWNhdGUoaWRlbnRpdHk6IEFjY291bnQgfCBudWxsKTogdm9pZCB7XG4gICAgdGhpcy51c2VySWRlbnRpdHkgPSBpZGVudGl0eTtcbiAgICB0aGlzLmF1dGhlbnRpY2F0aW9uU3RhdGUubmV4dCh0aGlzLnVzZXJJZGVudGl0eSk7XG4gICAgaWYgKCFpZGVudGl0eSkge1xuICAgICAgdGhpcy5hY2NvdW50Q2FjaGUkID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBoYXNBbnlBdXRob3JpdHkoYXV0aG9yaXRpZXM6IHN0cmluZ1tdIHwgc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLnVzZXJJZGVudGl0eSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoYXV0aG9yaXRpZXMpKSB7XG4gICAgICBhdXRob3JpdGllcyA9IFthdXRob3JpdGllc107XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnVzZXJJZGVudGl0eS5hdXRob3JpdGllcy5zb21lKChhdXRob3JpdHk6IHN0cmluZykgPT4gYXV0aG9yaXRpZXMuaW5jbHVkZXMoYXV0aG9yaXR5KSk7XG4gIH1cblxuICBpZGVudGl0eShmb3JjZT86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEFjY291bnQgfCBudWxsPiB7XG4gICAgaWYgKCF0aGlzLmFjY291bnRDYWNoZSQgfHwgZm9yY2UpIHtcbiAgICAgIHRoaXMuYWNjb3VudENhY2hlJCA9IHRoaXMuZmV0Y2goKS5waXBlKFxuICAgICAgICB0YXAoKGFjY291bnQ6IEFjY291bnQpID0+IHtcbiAgICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZShhY2NvdW50KTtcblxuICAgICAgICAgIC8vIEFmdGVyIHJldHJpZXZlIHRoZSBhY2NvdW50IGluZm8sIHRoZSBsYW5ndWFnZSB3aWxsIGJlIGNoYW5nZWQgdG9cbiAgICAgICAgICAvLyB0aGUgdXNlcidzIHByZWZlcnJlZCBsYW5ndWFnZSBjb25maWd1cmVkIGluIHRoZSBhY2NvdW50IHNldHRpbmdcbiAgICAgICAgICAvLyB1bmxlc3MgdXNlciBoYXZlIGNob29zZWQgb3RoZXIgbGFuZ3VhZ2UgaW4gdGhlIGN1cnJlbnQgc2Vzc2lvblxuICAgICAgICAgIGlmICghdGhpcy5zZXNzaW9uU3RvcmFnZVNlcnZpY2UucmV0cmlldmUoJ2xvY2FsZScpKSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zbGF0ZVNlcnZpY2UudXNlKGFjY291bnQubGFuZ0tleSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5uYXZpZ2F0ZVRvU3RvcmVkVXJsKCk7XG4gICAgICAgIH0pLFxuICAgICAgICBzaGFyZVJlcGxheSgpXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5hY2NvdW50Q2FjaGUkLnBpcGUoY2F0Y2hFcnJvcigoKSA9PiBvZihudWxsKSkpO1xuICB9XG5cbiAgaXNBdXRoZW50aWNhdGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnVzZXJJZGVudGl0eSAhPT0gbnVsbDtcbiAgfVxuXG4gIGdldEF1dGhlbnRpY2F0aW9uU3RhdGUoKTogT2JzZXJ2YWJsZTxBY2NvdW50IHwgbnVsbD4ge1xuICAgIHJldHVybiB0aGlzLmF1dGhlbnRpY2F0aW9uU3RhdGUuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBwcml2YXRlIGZldGNoKCk6IE9ic2VydmFibGU8QWNjb3VudD4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PEFjY291bnQ+KHRoaXMuYXBwbGljYXRpb25Db25maWdTZXJ2aWNlLmdldEVuZHBvaW50Rm9yKCdhcGkvYWNjb3VudCcpKTtcbiAgfVxuXG4gIHByaXZhdGUgbmF2aWdhdGVUb1N0b3JlZFVybCgpOiB2b2lkIHtcbiAgICAvLyBwcmV2aW91c1N0YXRlIGNhbiBiZSBzZXQgaW4gdGhlIGF1dGhFeHBpcmVkSW50ZXJjZXB0b3IgYW5kIGluIHRoZSB1c2VyUm91dGVBY2Nlc3NTZXJ2aWNlXG4gICAgLy8gaWYgbG9naW4gaXMgc3VjY2Vzc2Z1bCwgZ28gdG8gc3RvcmVkIHByZXZpb3VzU3RhdGUgYW5kIGNsZWFyIHByZXZpb3VzU3RhdGVcbiAgICBjb25zdCBwcmV2aW91c1VybCA9IHRoaXMuc3RhdGVTdG9yYWdlU2VydmljZS5nZXRVcmwoKTtcbiAgICBpZiAocHJldmlvdXNVcmwpIHtcbiAgICAgIHRoaXMuc3RhdGVTdG9yYWdlU2VydmljZS5jbGVhclVybCgpO1xuICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybChwcmV2aW91c1VybCk7XG4gICAgfVxuICB9XG59XG4iXX0=